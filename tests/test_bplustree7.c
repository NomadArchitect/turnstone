/*
 * This work is licensed under TURNSTONE OS Public License.
 * Please read and understand latest version of Licence.
 */

#include "setup.h"
#include <bplustree.h>
#include <utils.h>
#include <set.h>
#include <rbtree.h>
#include <strings.h>

int32_t main(int32_t argc, char_t** argv);

int32_t test_data[] = {
    0x816, 0x814, 0x811, 0x80B, 0x3EFF, 0x3EE7, 0x3ED2, 0x3EC8, 0x3EBF, 0x3EB6, 0x3EAD, 0x3EA3, 0x3E9A, 0x3E8B, 0x3E6A, 0x3E61,
    0x3E43, 0x3E39, 0x3E2F, 0x3E26, 0x3E1B, 0x3E0A, 0x3E00, 0x3DF7, 0x3DCE, 0x3DC5, 0x3DB6, 0x3DAB, 0x3D95, 0x3D8D, 0x3D84, 0x3D7A,
    0x3D4E, 0x3D44, 0x3D3B, 0x3D32, 0x3D1C, 0x3D11, 0x3D08, 0x3CFA, 0x3CE3, 0x3CD9, 0x3CC9, 0x3CC0, 0x3CB1, 0x3CA6, 0x3C9D, 0x3C8D, 0x3C81,
    0x3C78, 0x3C6E, 0x3C64, 0x3C54, 0x3C4B, 0x3C41, 0x3C37, 0x3C25, 0x3C1C, 0x3C13, 0x3C0A, 0x3BFE, 0x3BF5, 0x3BEC, 0x3BDF, 0x3BD7, 0x3BCF,
    0x3BC7, 0x3BBE, 0x3BB3, 0x3BAB, 0x3BA2, 0x3B91, 0x3B7C, 0x3B72, 0x3B5C, 0x3B4B, 0x3B42, 0x3B33, 0x3B2A, 0x3B21, 0x3B18, 0x3B10, 0x3AFA,
    0x3AF1, 0x3AC7, 0x3ABE, 0x3AB5, 0x3AAC, 0x3AA3, 0x3A94, 0x3A85, 0x3A7C, 0x3A73, 0x3A6A, 0x3A61, 0x3A58, 0x3A48, 0x3A38, 0x3A2F, 0x3A20,
    0x3A16, 0x3A0E, 0x39FA, 0x39EA, 0x39E1, 0x39D2, 0x39C8, 0x39C0, 0x39AA, 0x399A, 0x3990, 0x3987, 0x397E, 0x3975, 0x396C, 0x3963, 0x3959,
    0x394E, 0x3944, 0x393A, 0x392E, 0x3922, 0x390D, 0x38FD, 0x38F4, 0x38EB, 0x38C7, 0x38B6, 0x38AB, 0x38A2, 0x3890, 0x3885, 0x3875, 0x386B,
    0x385F, 0x384F, 0x383E, 0x3834, 0x3827, 0x3815, 0x380C, 0x3805, 0x37FC, 0x37F3, 0x37E0, 0x37D0, 0x37C2, 0x37BC, 0x37B3, 0x37AC, 0x37A3,
    0x379A, 0x3791, 0x3787, 0x3765, 0x3759, 0x3746, 0x373A, 0x3734, 0x3700, 0x36E9, 0x36E0, 0x36D7, 0x36C4, 0x36B4, 0x36A9, 0x36A0, 0x3695,
    0x368C, 0x3683, 0x367A, 0x366C, 0x3646, 0x363D, 0x362C, 0x3623, 0x3610, 0x35EF, 0x35DE, 0x35C5, 0x35AA, 0x3598, 0x3585, 0x357C, 0x356B,
    0x355C, 0x3546, 0x353D, 0x3534, 0x3529, 0x3514, 0x34F7, 0x34ED, 0x34E4, 0x34DB, 0x34C9, 0x34BD, 0x34AA, 0x3488, 0x347F, 0x346E, 0x3466,
    0x344D, 0x3401, 0x33F1, 0x33C7, 0x33BE, 0x3366, 0x3341, 0x3338, 0x3329, 0x3308, 0x32EB, 0x32C2, 0x32A1, 0x328C, 0x3283, 0x3274, 0x324D,
    0x323D, 0x3232, 0x3228, 0x321B, 0x3210, 0x31F9, 0x31F0, 0x31DB, 0x31D2, 0x31C2, 0x31B2, 0x31A1, 0x3193, 0x318A, 0x317F, 0x316F, 0x3166,
    0x3150, 0x3141, 0x3136, 0x3130, 0x3127, 0x311E, 0x3117, 0x3102, 0x30F4, 0x30E4, 0x30DC, 0x30CD, 0x30C0, 0x30B7, 0x30AE, 0x30A1, 0x3096,
    0x308C, 0x3083, 0x307A, 0x306E, 0x3066, 0x3041, 0x3032, 0x3027, 0x301C, 0x3013, 0x300A, 0x3000, 0x2FF7, 0x2FEE, 0x2FE6, 0x2F99, 0x2F8A,
    0x2F58, 0x2F48, 0x2F3E, 0x2F35, 0x2F2A, 0x2F1F, 0x2F16, 0x2F06, 0x2EF3, 0x2EE6, 0x2EC8, 0x2EBF, 0x2EA0, 0x2E90, 0x2E86, 0x2E7D, 0x2E6F,
    0x2E66, 0x2E53, 0x2E4A, 0x2E3D, 0x2E34, 0x2E2A, 0x2E22, 0x2E19, 0x2E10, 0x2E07, 0x2DFF, 0x2DED, 0x2DE3, 0x2DDB, 0x2DD2, 0x2DC0, 0x2DAE,
    0x2D9B, 0x2D91, 0x2D88, 0x2D7E, 0x2D75, 0x2D64, 0x2D5C, 0x2D54, 0x2D4B, 0x2D41, 0x2D23, 0x2D19, 0x2D10, 0x2D08, 0x2CEB, 0x2CD4, 0x2CCB,
    0x2CB5, 0x2C8C, 0x2C7B, 0x2C72, 0x2C58, 0x2C34, 0x2C2A, 0x2BF7, 0x2BCE, 0x2B8B, 0x2B82, 0x2B79, 0x2B6D, 0x2B65, 0x2B5C, 0x2B53, 0x2B4C,
    0x2B44, 0x2B2C, 0x2B1C, 0x2B14, 0x2B0E, 0x2AFE, 0x2AF6, 0x2AF0, 0x2AEA, 0x2ADA, 0x2AC4, 0x2ABB, 0x2AAF, 0x2AA6, 0x2A9D, 0x2A94,
    0x2A8B, 0x2A82, 0x2A78, 0x2A6F, 0x2A65, 0x2A54, 0x2A31, 0x2A21, 0x2A09, 0x2A00, 0x29F6, 0x29ED, 0x29D0, 0x29C7, 0x29BE, 0x29B5,
    0x29AC, 0x29A3, 0x2995, 0x298C, 0x296B, 0x2959, 0x294F, 0x2946, 0x293C, 0x2931, 0x2927, 0x2918, 0x290E, 0x2903, 0x28F7, 0x28EE,
    0x28D1, 0x28BF, 0x28AB, 0x28A2, 0x2894, 0x2889, 0x287F, 0x2876, 0x286D, 0x284C, 0x283B, 0x2832, 0x281F, 0x2818, 0x280F, 0x2805,
    0x27FC, 0x27F3, 0x27EA, 0x27E2, 0x27DA, 0x27D1, 0x27C5, 0x27BA, 0x27B2, 0x27A9, 0x2799, 0x277D, 0x2773, 0x276A, 0x2761, 0x2757,
    0x2746, 0x272A, 0x2721, 0x270D, 0x2703, 0x26FA, 0x26F1, 0x26E9, 0x26DF, 0x26D6, 0x26CC, 0x26C3, 0x26B5, 0x26A7, 0x269D, 0x268D,
    0x267E, 0x2674, 0x266B, 0x2662, 0x2659, 0x2650, 0x2647, 0x263F, 0x2629, 0x2610, 0x2604, 0x25F5, 0x25EC, 0x25E3, 0x25D3, 0x25C4,
    0x25BB, 0x25AC, 0x25A3, 0x2594, 0x2583, 0x2574, 0x255D, 0x2553, 0x2549, 0x2536, 0x252D, 0x2521, 0x2518, 0x24EC, 0x24E2, 0x24D7,
    0x24CD, 0x2495, 0x248C, 0x246C, 0x2451, 0x2441, 0x2430, 0x2420, 0x2411, 0x23FB, 0x23EB, 0x23E0, 0x23D7, 0x23CC, 0x23C4, 0x2394,
    0x2379, 0x235A, 0x233F, 0x2331, 0x2328, 0x231E, 0x2315, 0x230A, 0x22FA, 0x22F1, 0x22D8, 0x22CF, 0x22C5, 0x22BC, 0x22B2, 0x22A8,
    0x2299, 0x228F, 0x2283, 0x2273, 0x226A, 0x2261, 0x2252, 0x2249, 0x2240, 0x2237, 0x221F, 0x2209, 0x21ED, 0x21D7, 0x21CE, 0x21BE, 0x2199,
    0x2189, 0x2180, 0x216B, 0x215B, 0x2152, 0x2137, 0x212E, 0x2103, 0x20F1, 0x20E8, 0x20DA, 0x20D0, 0x20C7, 0x20B5, 0x20A9, 0x209F, 0x2098,
    0x2088, 0x207F, 0x2076, 0x206D, 0x2065, 0x205D, 0x2051, 0x2047, 0x203F, 0x2036, 0x2028, 0x2020, 0x201A, 0x2010, 0x2002, 0x1FFC, 0x1FEF,
    0x1FD8, 0x1FCF, 0x1FB9, 0x1FAF, 0x1FA5, 0x1F92, 0x1F82, 0x1F73, 0x1F63, 0x1F52, 0x1F4A, 0x1F2F, 0x1F26, 0x1F1D, 0x1F08, 0x1EFE, 0x1EF5,
    0x1EEC, 0x1EDC, 0x1EC7, 0x1EBE, 0x1EB1, 0x1EA8, 0x1E9D, 0x1E94, 0x1E8B, 0x1E82, 0x1E43, 0x1E2A, 0x1E14, 0x1E0B, 0x1E02, 0x1DF7, 0x1DEE,
    0x1DE4, 0x1DD8, 0x1DCD, 0x1DC2, 0x1DB9, 0x1DA3, 0x1D90, 0x1D80, 0x1D77, 0x1D6B, 0x1D62, 0x1D59, 0x1D50, 0x1D44, 0x1D3B, 0x1D31, 0x1D28,
    0x1D14, 0x1D0B, 0x1D01, 0x1CF1, 0x1CE8, 0x1CDF, 0x1CC5, 0x1CB8, 0x1CB1, 0x1CA1, 0x1C98, 0x1C8F, 0x1C83, 0x1C72, 0x1C6C, 0x1C66, 0x1C5C,
    0x1C54, 0x1C45, 0x1C3B, 0x1C32, 0x1C27, 0x1C1C, 0x1C13, 0x1BFE, 0x1BF5, 0x1BE5, 0x1BDD, 0x1BD3, 0x1BCA, 0x1BC1, 0x1BB8, 0x1BAB, 0x1BA2,
    0x1B98, 0x1B8E, 0x1B78, 0x1B6E, 0x1B65, 0x1B5A, 0x1B51, 0x1B4A, 0x1B40, 0x1B38, 0x1B30, 0x1B26, 0x1B1D, 0x1B17, 0x1B05, 0x1AFC, 0x1AED,
    0x1AE2, 0x1AD9, 0x1AD0, 0x1AC7, 0x1ABC, 0x1A96, 0x1A8B, 0x1A06, 0x19F3, 0x19CD, 0x19C4, 0x19B9, 0x19AA, 0x19A1, 0x1991, 0x1987, 0x1977,
    0x1966, 0x1958, 0x194E, 0x1940, 0x1937, 0x1924, 0x1919, 0x1910, 0x1907, 0x18FE, 0x1876, 0x186C, 0x178F, 0x1787, 0x177B, 0x1759, 0x174F,
    0x1744, 0x1735, 0x172B, 0x1723, 0x171B, 0x16F9, 0x16F0, 0x16E9, 0x16D9, 0x16D2, 0x16C5, 0x16B9, 0x16B1, 0x16AA, 0x16A3, 0x169A, 0x168C,
    0x167F, 0x1677, 0x1665, 0x165B, 0x1653, 0x15C4, 0x15BB, 0x15AC, 0x15A3, 0x159A, 0x1591, 0x1588, 0x157D, 0x1574, 0x156B, 0x1560, 0x1557,
    0x154E, 0x1544, 0x153B, 0x1532, 0x1529, 0x1520, 0x1517, 0x150E, 0x1506, 0x14FD, 0x14F4, 0x14E3, 0x14D8, 0x14CD, 0x14C4, 0x14AB, 0x147E,
    0x146E, 0x1440, 0x1437, 0x1428, 0x140C, 0x13F9, 0x13E9, 0x13D3, 0x13CA, 0x13BB, 0x13A5, 0x1378, 0x1362, 0x1353, 0x1349, 0x130F, 0x12F3,
    0x12E4, 0x12D9, 0x12D0, 0x12C6, 0x12A3, 0x1294, 0x128A, 0x1281, 0x125E, 0x124F, 0x1246, 0x1238, 0x1215, 0x1206, 0x11FC, 0x11F3, 0x11E5,
    0x11DC, 0x11D1, 0x11C8, 0x11BD, 0x11B4, 0x11AA, 0x11A1, 0x118F, 0x1186, 0x1177, 0x1168, 0x1159, 0x1148, 0x112C, 0x111B, 0x10FA, 0x10F0,
    0x10E7, 0x10DE, 0x10D4, 0x10BC, 0x10AD, 0x10A4, 0x1098, 0x108E, 0x1073, 0x1064, 0x105C, 0x1054, 0x104B, 0x1042, 0x1039, 0x102D, 0x1024,
    0x1015, 0x100C, 0x1003, 0xFF9, 0xFF0, 0xFE4, 0xFDB, 0xFD2, 0xFC7, 0xFBF, 0xFB6, 0xFAD, 0xF7C, 0xF73, 0xF65, 0xF5C, 0xF51, 0xF36, 0xF20,
    0xF11, 0xEEA, 0xEE1, 0xED8, 0xEC8, 0xEAC, 0xE96, 0xE6E, 0xE66, 0xE5D, 0xE51, 0xE47, 0xE3D, 0xE14, 0xE0A, 0xE01, 0xDF2, 0xDE9, 0xDE1,
    0xDA7, 0xD9D, 0xD61, 0xD56, 0xD4D, 0xD44, 0xD36, 0xD2D, 0xD04, 0xCFB, 0xC71, 0xC61, 0xC58, 0xC48, 0xC33, 0xC25, 0xC12, 0xC06, 0xBFD,
    0xBF0, 0xBE6, 0xBD6, 0xBCD, 0xBC2, 0xBAC, 0xB8F, 0xB57, 0xB44, 0xB27, 0xB10, 0xB07, 0xAFE, 0xAEC, 0xAE4, 0xABD, 0xAAE, 0xA9A, 0xA90,
    0xA7A, 0xA71, 0xA68, 0xA60, 0xA43, 0xA3A, 0x801, 0x7F8, 0x7E1, 0x7D8, 0x7CB, 0x7BE, 0x787, 0x77A, 0x767, 0x759, 0x751, 0x73E, 0x735,
    0x726, 0x71D, 0x711, 0x704, 0x6F1, 0x6C8, 0x6AA, 0x67E, 0x677, 0x66A, 0x651, 0x649, 0x641, 0x631, 0x625, 0x618, 0x611, 0x606, 0x5FD,
    0x5E3, 0x5DC, 0x5C9, 0x5BB, 0x5B1, 0x5A9, 0x596, 0x575, 0x567, 0x54E, 0x546, 0x538, 0x530, 0x521, 0x518, 0x510, 0x504, 0x4FD, 0x4F6,
    0x4E4, 0x4DD, 0x4D0, 0x4C7, 0x4B6, 0x4AD, 0x4A4, 0x49A, 0x48C, 0x477, 0x467, 0x45E, 0x453, 0x449, 0x440, 0x430, 0x41B, 0x401, 0x3F6,
    0x3EE, 0x3E5, 0x3D4, 0x3CA, 0x3C1, 0x3BA, 0x3AF, 0x3A5, 0x39E, 0x395, 0x38A, 0x37E, 0x374, 0x345, 0x33B, 0x32C, 0x31D, 0x314, 0x308,
    0x2FF, 0x2F7, 0x2EE, 0x2E5, 0x2DC, 0x2D2, 0x2C9, 0x2C0, 0x2B7, 0x2AE, 0x2A5, 0x29C, 0x25C, 0x253, 0x248, 0x233, 0x22A, 0x21A, 0x20A,
    0x202, 0x1F1, 0x1E4, 0x1CE, 0x1C5, 0x1BB, 0x1AD, 0x1A4, 0x19B, 0x192, 0x189, 0x180, 0x169, 0x160, 0x159, 0x14A, 0x142, 0x139, 0x111,
    0x10A, 0xFF, 0xF7, 0xEF, 0xE3, 0xDB, 0xD2, 0xCA, 0xC1, 0xB9, 0xB0, 0xA4, 0x98, 0x8F, 0x86, 0x7D, 0x73, 0x6A, 0x61, 0x45, 0x3C, 0x33,
    0x1E, 0x7F0, 0x7F0, 0x7EF, 0x2FB2, 0x7EE, 0x7ED, 0x7EC, 0x48F, 0x2003, 0x1FF2, 0x807, 0x1865, 0x813, 0x808, 0x1AB3, 0x1AAA, 0x1AA6,
    0x1A9C, 0x806, 0x1CAB, 0x1C60, 0x7EB, 0x7EA, 0x7E9, 0x7E8, 0x7E7, 0x7E6, 0x7E5, 0x7E4, 0x7E3, 0x7E2, 0x7E1, 0x7E0, 0x7DF, 0x7DE, 0x7DD,
    0x7DC, 0x7DB, 0x7DA, 0x7D9, 0x7D8, 0x7D7, 0x7D6, 0x7D5, 0x7D4, 0x7D3, 0x7D2, 0x7D1, 0x7D0, 0x7CF, 0x7CE, 0x3F40, 0x3F3F, 0x3F3D,
    0x3F3C, 0x3F3B, 0x3F3A, 0x3F39, 0x3F38, 0x3F37, 0x3F36, 0x3F35, 0x3F34, 0x3F33, 0x3F31, 0x3F2E, 0x3F2D, 0x3F2C, 0x3F2B, 0x3F2A,
    0x3F28, 0x3F25, 0x3F24, 0x3F23, 0x3F22, 0x3F21, 0x3F20, 0x3F1F, 0x3EFF, 0x3EE7, 0x3ED2, 0x3EC8, 0x3EBF, 0x3EB6, 0x3EAD, 0x3EA3,
    0x3E9A, 0x3E8B, 0x3E6A, 0x3E61, 0x3E43, 0x3E39, 0x3E2F, 0x3E26, 0x3E1B, 0x3E0A, 0x3E00, 0x3DF7, 0x3DCE, 0x3DC5, 0x3DB6, 0x3DAB,
    0x3D95, 0x3D8D, 0x3D84, 0x3D7A, 0x3D4E, 0x3D44, 0x3D3B, 0x3D32, 0x3D1C, 0x3D11, 0x3D08, 0x3CFA, 0x3CE3, 0x3CD9, 0x3CC9, 0x3CC0,
    0x3CB1, 0x3CA6, 0x3C9D, 0x3C8D, 0x3C81, 0x3C78, 0x3C6E, 0x3C64, 0x3C54, 0x3C4B, 0x3C41, 0x3C37, 0x3C25, 0x3C1C, 0x3C13, 0x3C0A, 0x3BFE,
    0x3BF5, 0x3BEC, 0x3BDF, 0x3BD7, 0x3BCF, 0x3BC7, 0x3BBE, 0x3BB3, 0x3BAB, 0x3BA2, 0x3B91, 0x3B7C, 0x3B72, 0x3B5C, 0x3B4B, 0x3B42, 0x3B33,
    0x3B2A, 0x3B21, 0x3B18, 0x3B10, 0x3AFA, 0x3AF1, 0x3AC7, 0x3ABE, 0x3AB5, 0x3AAC, 0x3AA3, 0x3A94, 0x3A85, 0x3A7C, 0x3A73, 0x3A6A, 0x3A61,
    0x3A58, 0x3A48, 0x3A38, 0x3A2F, 0x3A20, 0x3A16, 0x3A0E, 0x39FA, 0x39EA, 0x39E1, 0x39D2, 0x39C8, 0x39C0, 0x39AA, 0x399A, 0x3990, 0x3987,
    0x397E, 0x3975, 0x396C, 0x3963, 0x3959, 0x394E, 0x3944, 0x393A, 0x392E, 0x3922, 0x390D, 0x38FD, 0x38F4, 0x38EB, 0x38C7, 0x38B6, 0x38AB,
    0x38A2, 0x3890, 0x3885, 0x3875, 0x386B, 0x385F, 0x384F, 0x383E, 0x3834, 0x3827, 0x3815, 0x380C, 0x3805, 0x37FC, 0x37F3, 0x37E0, 0x37D0,
    0x37C2, 0x37BC, 0x37B3, 0x37AC, 0x37A3, 0x379A, 0x3791, 0x3787, 0x3765, 0x3759, 0x3746, 0x373A, 0x3734, 0x3700, 0x36E9, 0x36E0, 0x36D7,
    0x36C4, 0x36B4, 0x36A9, 0x36A0, 0x3695, 0x368C, 0x3683, 0x367A, 0x366C, 0x3646, 0x363D, 0x362C, 0x3623, 0x3610, 0x35EF, 0x35DE, 0x35C5,
    0x35AA, 0x3598, 0x3585, 0x357C, 0x356B, 0x355C, 0x3546, 0x353D, 0x3534, 0x3529, 0x3514, 0x34F7, 0x34ED, 0x34E4, 0x34DB, 0x34C9, 0x34BD,
    0x34AA, 0x3488, 0x347F, 0x346E, 0x3466, 0x344D, 0x3401, 0x33F1, 0x33C7, 0x33BE, 0x3366, 0x3341, 0x3338, 0x3329, 0x3308, 0x32EB, 0x32C2,
    0x32A1, 0x328C, 0x3283, 0x3274, 0x324D, 0x323D, 0x3232, 0x3228, 0x321B, 0x3210, 0x31F9, 0x31F0, 0x31DB, 0x31D2, 0x31C2, 0x31B2, 0x31A1,
    0x3193, 0x318A, 0x317F, 0x316F, 0x3166, 0x3150, 0x3141, 0x3136, 0x3130, 0x3127, 0x311E, 0x3117, 0x3102, 0x30F4, 0x30E4, 0x30DC, 0x30CD,
    0x30C0, 0x30B7, 0x30AE, 0x30A1, 0x3096, 0x308C, 0x3083, 0x307A, 0x306E, 0x3066, 0x3041, 0x3032, 0x3027, 0x301C, 0x3013, 0x300A, 0x3000,
    0x2FF7, 0x2FEE, 0x2FE6, 0x2FB2, 0x2F99, 0x2F8A, 0x2F58, 0x2F48, 0x2F3E, 0x2F35, 0x2F2A, 0x2F1F, 0x2F16, 0x2F06, 0x2EF3, 0x2EE6, 0x2EC8,
    0x2EBF, 0x2EA0, 0x2E90, 0x2E86, 0x2E7D, 0x2E6F, 0x2E66, 0x2E53, 0x2E4A, 0x2E3D, 0x2E34, 0x2E2A, 0x2E22, 0x2E19, 0x2E10, 0x2E07, 0x2DFF,
    0x2DED, 0x2DE3, 0x2DDB, 0x2DD2, 0x2DC0, 0x2DAE, 0x2D9B, 0x2D91, 0x2D88, 0x2D7E, 0x2D75, 0x2D64, 0x2D5C, 0x2D54, 0x2D4B, 0x2D41, 0x2D23,
    0x2D19, 0x2D10, 0x2D08, 0x2CEB, 0x2CD4, 0x2CCB, 0x2CB5, 0x2C8C, 0x2C7B, 0x2C72, 0x2C58, 0x2C34, 0x2C2A, 0x2BF7, 0x2BCE, 0x2B8B, 0x2B82,
    0x2B79, 0x2B6D, 0x2B65, 0x2B5C, 0x2B53, 0x2B4C, 0x2B44, 0x2B2C, 0x2B1C, 0x2B14, 0x2B0E, 0x2AFE, 0x2AF6, 0x2AF0, 0x2AEA, 0x2ADA, 0x2AC4,
    0x2ABB, 0x2AAF, 0x2AA6, 0x2A9D, 0x2A94, 0x2A8B, 0x2A82, 0x2A78, 0x2A6F, 0x2A65, 0x2A54, 0x2A31, 0x2A21, 0x2A09, 0x2A00, 0x29F6, 0x29ED,
    0x29D0, 0x29C7, 0x29BE, 0x29B5, 0x29AC, 0x29A3, 0x2995, 0x298C, 0x296B, 0x2959, 0x294F, 0x2946, 0x293C, 0x2931, 0x2927, 0x2918, 0x290E,
    0x2903, 0x28F7, 0x28EE, 0x28D1, 0x28BF, 0x28AB, 0x28A2, 0x2894, 0x2889, 0x287F, 0x2876, 0x286D, 0x284C, 0x283B, 0x2832, 0x281F, 0x2818,
    0x280F, 0x2805, 0x27FC, 0x27F3, 0x27EA, 0x27E2, 0x27DA, 0x27D1, 0x27C5, 0x27BA, 0x27B2, 0x27A9, 0x2799, 0x277D, 0x2773, 0x276A, 0x2761,
    0x2757, 0x2746, 0x272A, 0x2721, 0x270D, 0x2703, 0x26FA, 0x26F1, 0x26E9, 0x26DF, 0x26D6, 0x26CC, 0x26C3, 0x26B5, 0x26A7, 0x269D, 0x268D,
    0x267E, 0x2674, 0x266B, 0x2662, 0x2659, 0x2650, 0x2647, 0x263F, 0x2629, 0x2610, 0x2604, 0x25F5, 0x25EC, 0x25E3, 0x25D3, 0x25C4, 0x25BB,
    0x25AC, 0x25A3, 0x2594, 0x2583, 0x2574, 0x255D, 0x2553, 0x2549, 0x2536, 0x252D, 0x2521, 0x2518, 0x24EC, 0x24E2, 0x24D7, 0x24CD, 0x2495,
    0x248C, 0x246C, 0x2451, 0x2441, 0x2430, 0x2420, 0x2411, 0x23FB, 0x23EB, 0x23E0, 0x23D7, 0x23CC, 0x23C4, 0x2394, 0x2379, 0x235A, 0x233F,
    0x2331, 0x2328, 0x231E, 0x2315, 0x230A, 0x22FA, 0x22F1, 0x22D8, 0x22CF, 0x22C5, 0x22BC, 0x22B2, 0x22A8, 0x2299, 0x228F, 0x2283, 0x2273,
    0x226A, 0x2261, 0x2252, 0x2249, 0x2240, 0x2237, 0x221F, 0x2209, 0x21ED, 0x21D7, 0x21CE, 0x21BE, 0x2199, 0x2189, 0x2180, 0x216B, 0x215B,
    0x2152, 0x2137, 0x212E, 0x2103, 0x20F1, 0x20E8, 0x20DA, 0x20D0, 0x20C7, 0x20B5, 0x20A9, 0x209F, 0x2098, 0x2088, 0x207F, 0x2076, 0x206D,
    0x2065, 0x205D, 0x2051, 0x2047, 0x203F, 0x2036, 0x2028, 0x2020, 0x201A, 0x2010, 0x2003, 0x2002, 0x1FFC, 0x1FF2, 0x1FEF, 0x1FD8, 0x1FCF,
    0x1FB9, 0x1FAF, 0x1FA5, 0x1F92, 0x1F82, 0x1F73, 0x1F63, 0x1F52, 0x1F4A, 0x1F2F, 0x1F26, 0x1F1D, 0x1F08, 0x1EFE, 0x1EF5, 0x1EEC, 0x1EDC,
    0x1EC7, 0x1EBE, 0x1EB1, 0x1EA8, 0x1E9D, 0x1E94, 0x1E8B, 0x1E82, 0x1E43, 0x1E2A, 0x1E14, 0x1E0B, 0x1E02, 0x1DF7, 0x1DEE, 0x1DE4, 0x1DD8,
    0x1DCD, 0x1DC2, 0x1DB9, 0x1DA3, 0x1D90, 0x1D80, 0x1D77, 0x1D6B, 0x1D62, 0x1D59, 0x1D50, 0x1D44, 0x1D3B, 0x1D31, 0x1D28, 0x1D14, 0x1D0B,
    0x1D01, 0x1CF1, 0x1CE8, 0x1CDF, 0x1CC5, 0x1CB8, 0x1CB1, 0x1CAB, 0x1CA1, 0x1C98, 0x1C8F, 0x1C83, 0x1C72, 0x1C6C, 0x1C66, 0x1C60, 0x1C5C,
    0x1C54, 0x1C45, 0x1C3B, 0x1C32, 0x1C27, 0x1C1C, 0x1C13, 0x1BFE, 0x1BF5, 0x1BE5, 0x1BDD, 0x1BD3, 0x1BCA, 0x1BC1, 0x1BB8, 0x1BAB, 0x1BA2,
    0x1B98, 0x1B8E, 0x1B78, 0x1B6E, 0x1B65, 0x1B5A, 0x1B51, 0x1B4A, 0x1B40, 0x1B38, 0x1B30, 0x1B26, 0x1B1D, 0x1B17, 0x1B05, 0x1AFC, 0x1AED,
    0x1AE2, 0x1AD9, 0x1AD0, 0x1AC7, 0x1ABC, 0x1AB3, 0x1AAA, 0x1AA6, 0x1A9C, 0x1A96, 0x1A8B, 0x1A06, 0x19F3, 0x19CD, 0x19C4, 0x19B9, 0x19AA,
    0x19A1, 0x1991, 0x1987, 0x1977, 0x1966, 0x1958, 0x194E, 0x1940, 0x1937, 0x1924, 0x1919, 0x1910, 0x1907, 0x18FE, 0x1876, 0x186C, 0x1865,
    0x178F, 0x1787, 0x177B, 0x1759, 0x174F, 0x1744, 0x1735, 0x172B, 0x1723, 0x171B, 0x16F9, 0x16F0, 0x16E9, 0x16D9, 0x16D2, 0x16C5, 0x16B9,
    0x16B1, 0x16AA, 0x16A3, 0x169A, 0x168C, 0x167F, 0x1677, 0x1665, 0x165B, 0x1653, 0x15C4, 0x15BB, 0x15AC, 0x15A3, 0x159A, 0x1591, 0x1588,
    0x157D, 0x1574, 0x156B, 0x1560, 0x1557, 0x154E, 0x1544, 0x153B, 0x1532, 0x1529, 0x1520, 0x1517, 0x150E, 0x1506, 0x14FD, 0x14F4, 0x14E3,
    0x14D8, 0x14CD, 0x14C4, 0x14AB, 0x147E, 0x146E, 0x1440, 0x1437, 0x1428, 0x140C, 0x13F9, 0x13E9, 0x13D3, 0x13CA, 0x13BB, 0x13A5, 0x1378,
    0x1362, 0x1353, 0x1349, 0x130F, 0x12F3, 0x12E4, 0x12D9, 0x12D0, 0x12C6, 0x12A3, 0x1294, 0x128A, 0x1281, 0x125E, 0x124F, 0x1246, 0x1238,
    0x1215, 0x1206, 0x11FC, 0x11F3, 0x11E5, 0x11DC, 0x11D1, 0x11C8, 0x11BD, 0x11B4, 0x11AA, 0x11A1, 0x118F, 0x1186, 0x1177, 0x1168, 0x1159,
    0x1148, 0x112C, 0x111B, 0x10FA, 0x10F0, 0x10E7, 0x10DE, 0x10D4, 0x10BC, 0x10AD, 0x10A4, 0x1098, 0x108E, 0x1073, 0x1064, 0x105C, 0x1054,
    0x104B, 0x1042, 0x1039, 0x102D, 0x1024, 0x1015, 0x100C, 0x1003, 0xFF9, 0xFF0, 0xFE4, 0xFDB, 0xFD2, 0xFC7, 0xFBF, 0xFB6, 0xFAD, 0xF7C,
    0xF73, 0xF65, 0xF5C, 0xF51, 0xF36, 0xF20, 0xF11, 0xEEA, 0xEE1, 0xED8, 0xEC8, 0xEAC, 0xE96, 0xE6E, 0xE66, 0xE5D, 0xE51, 0xE47, 0xE3D,
    0xE14, 0xE0A, 0xE01, 0xDF2, 0xDE9, 0xDE1, 0xDA7, 0xD9D, 0xD61, 0xD56, 0xD4D, 0xD44, 0xD36, 0xD2D, 0xD04, 0xCFB, 0xC71, 0xC61, 0xC58,
    0xC48, 0xC33, 0xC25, 0xC12, 0xC06, 0xBFD, 0xBF0, 0xBE6, 0xBD6, 0xBCD, 0xBC2, 0xBAC, 0xB8F, 0xB57, 0xB44, 0xB27, 0xB10, 0xB07, 0xAFE,
    0xAEC, 0xAE4, 0xABD, 0xAAE, 0xA9A, 0xA90, 0xA7A, 0xA71, 0xA68, 0xA60, 0xA43, 0xA3A, 0x816, 0x814, 0x813, 0x811, 0x80B, 0x808, 0x807,
    0x806, 0x801, 0x7F8, 0x7CB, 0x7BE, 0x787, 0x77A, 0x767, 0x759, 0x751, 0x73E, 0x735, 0x726, 0x71D, 0x711, 0x704, 0x6F1, 0x6C8, 0x6AA,
    0x67E, 0x677, 0x66A, 0x651, 0x649, 0x641, 0x631, 0x625, 0x618, 0x611, 0x606, 0x5FD, 0x5E3, 0x5DC, 0x5C9, 0x5BB, 0x5B1, 0x5A9, 0x596,
    0x575, 0x567, 0x54E, 0x546, 0x538, 0x530, 0x521, 0x518, 0x510, 0x504, 0x4FD, 0x4F6, 0x4E4, 0x4DD, 0x4D0, 0x4C7, 0x4B6, 0x4AD, 0x4A4,
    0x49A, 0x48F, 0x48C, 0x477, 0x467, 0x45E, 0x453, 0x449, 0x440, 0x430, 0x41B, 0x401, 0x3F6, 0x3EE, 0x3E5, 0x3D4, 0x3CA, 0x3C1, 0x3BA,
    0x3AF, 0x3A5, 0x39E, 0x395, 0x38A, 0x37E, 0x374, 0x345, 0x33B, 0x32C, 0x31D, 0x314, 0x308, 0x2FF, 0x2F7, 0x2EE, 0x2E5, 0x2DC, 0x2D2,
    0x2C9, 0x2C0, 0x2B7, 0x2AE, 0x2A5, 0x29C, 0x25C, 0x253, 0x248, 0x233, 0x22A, 0x21A, 0x20A, 0x202, 0x1F1, 0x1E4, 0x1CE, 0x1C5, 0x1BB,
    0x1AD, 0x1A4, 0x19B, 0x192, 0x189, 0x180, 0x169, 0x160, 0x159, 0x14A, 0x142, 0x139, 0x111, 0x10A, 0xFF, 0xF7, 0xEF, 0xE3, 0xDB, 0xD2,
    0xCA, 0xC1, 0xB9, 0xB0, 0xA4, 0x98, 0x8F, 0x86, 0x7D, 0x73, 0x6A, 0x61, 0x45, 0x3C, 0x33, 0x1E,

};

_Static_assert(sizeof(test_data) / sizeof(int) == 2163, "test data size must be 256");


typedef struct tosdb_memtable_index_item_t {
    uint128_t record_id;
    uint64_t  key_hash;
    boolean_t is_deleted;
    uint64_t  offset;
    uint64_t  length;
    uint64_t  key_length;
    uint8_t   key[];
}__attribute__((packed, aligned(8))) tosdb_memtable_index_item_t;


int8_t tosdb_memtable_index_comparator(const void* i1, const void* i2);

int8_t tosdb_memtable_index_comparator(const void* i1, const void* i2) {
    const tosdb_memtable_index_item_t* ti1 = (tosdb_memtable_index_item_t*)i1;
    const tosdb_memtable_index_item_t* ti2 = (tosdb_memtable_index_item_t*)i2;

    if(ti1->key_hash < ti2->key_hash) {
        return -1;
    }

    if(ti1->key_hash > ti2->key_hash) {
        return 1;
    }

    if(!ti1->key_length && !ti1->key_length) {
        return 0;
    }

    printf(".");

    uint64_t min = MIN(ti1->key_length, ti2->key_length);

    int8_t res = memory_memcompare(ti1->key, ti2->key, min);

    if(res != 0) {
        return res;
    }

    if(ti1->key_length < ti2->key_length) {
        return -1;
    }

    if(ti1->key_length > ti2->key_length) {
        return 1;
    }

    return 0;
}

static int8_t int_comparator(const void* i1, const void* i2) {
    int32_t* ti1 = (int32_t*)i1;
    int32_t* ti2 = (int32_t*)i2;

    if(*ti1 < *ti2) {
        return -1;
    }

    if(*ti1 > *ti2) {
        return 1;
    }

    return 0;
}

int32_t key_clone_destroy_count = 0;

static int8_t key_destroyer(memory_heap_t* heap, void* key) {
    printf("destroying key %p\n", key);
    memory_free_ext(heap, key);
    key_clone_destroy_count--;
    return 0;
}

static int8_t key_cloner(memory_heap_t* heap, const void* key, void** cloned_key) {
    if(!key || !cloned_key) {
        return -1;
    }

    tosdb_memtable_index_item_t* src = (tosdb_memtable_index_item_t*)key;

    uint64_t key_size = sizeof(tosdb_memtable_index_item_t) + src->key_length;

    *cloned_key = memory_malloc_ext(heap, key_size, 0);

    if(!*cloned_key) {
        return -1;
    }

    memory_memcopy(key, *cloned_key, key_size);
    key_clone_destroy_count++;
    return 0;
}

int32_t main(int32_t argc, char_t** argv){
    argc--;
    argv++;

    int32_t max_key_count = 32;
    int32_t item_count = sizeof(test_data) / sizeof(int32_t);

    if(argc == 1) {
        item_count = atoi(argv[0]);
    }

    set_t* set = set_create(int_comparator);

    for(int32_t i = 0; i < item_count; i++) {
        set_append(set, &test_data[i]);
    }

    int32_t uniq_item_count = set_size(set);

    set_destroy(set);

    index_t* idx = bplustree_create_index_with_unique(max_key_count, tosdb_memtable_index_comparator, true);
    bplustree_set_key_destroyer(idx, key_destroyer);
    bplustree_set_key_cloner(idx, key_cloner);

    if(idx == NULL) {
        print_error("b+ tree can not created");
        return -1;
    }

    printf("item count: %i\n", item_count);

    for(int32_t i = 0; i < item_count; i++) {
        tosdb_memtable_index_item_t* deleted = NULL;

        tosdb_memtable_index_item_t* item = memory_malloc(sizeof(tosdb_memtable_index_item_t));

        if(!item) {
            print_error("item can not created");
            return -1;
        }

        item->key_hash = test_data[i];

        idx->insert(idx, item, item, (void**)&deleted);

        printf("inserted: 0x%x ", test_data[i]);

        if(deleted != NULL) {
            printf("deleted: 0x%llx", deleted->key_hash);
            memory_free(deleted);
        }

        printf("\n");
    }

    print_success("b+ tree builded");

    int32_t tree_size = idx->size(idx);

    if(tree_size != uniq_item_count) {
        print_error("tree size %i != uniq item count %i", tree_size, uniq_item_count);
    } else {
        print_success("tree size %i == uniq item count %i", tree_size, uniq_item_count);
    }

    for(int32_t i = 0; i < item_count / 8; i++) {
        tosdb_memtable_index_item_t key = {.key_hash = test_data[i]};
        tosdb_memtable_index_item_t* item = NULL;

        idx->delete(idx, &key, (void**)&item);

        if(item == NULL) {
            print_error("item not found: 0x%x", test_data[i]);
        } else {
            if(item->key_hash != (uint64_t)test_data[i]) {
                print_error("item key hash 0x%llx != 0x%x", item->key_hash, test_data[i]);
            } else {
                print_success("item found: 0x%x", test_data[i]);
            }

            memory_free(item);
        }

    }

    iterator_t* iter = idx->create_iterator(idx);
    printf("iterator created: %p\n", iter);

    uint64_t prev = 0;

    while(iter->end_of_iterator(iter) != 0) {
        tosdb_memtable_index_item_t* item = (tosdb_memtable_index_item_t*)iter->get_item(iter);
        tosdb_memtable_index_item_t* key = (tosdb_memtable_index_item_t*)iter->get_extra_data(iter);

        if(item->key_hash < prev) {
            print_error("key hash 0x%llx < prev 0x%llx", item->key_hash, prev);
        }

        if(key->key_hash < prev) {
            print_error("key hash 0x%llx < prev 0x%llx", item->key_hash, prev);
        }

        prev = item->key_hash;

        memory_free(item);

        iter = iter->next(iter);
    }

    printf("\niteration ended\n");

    iter->destroy(iter);

    printf("iterator destroyed\n");

    printf("destroying b+ tree\n");
    bplustree_destroy_index(idx);

    printf("unique item count: %i\n", uniq_item_count);

    printf("key clone destroy count: %i\n", key_clone_destroy_count);

    print_success("all tests are passed");

    return 0;
}
